generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// The main Student model linked to Clerk
model Student {
  id           String   @id @default(cuid())
  clerkId      String   @unique // The unique ID from Clerk
  email        String   @unique
  name         String?
  
  // Student-specific metadata for AI personalization
  interests    String[] 
  learningGoal String?  @db.Text
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relationships
  activities      Activity[]
  savedTools      SavedToolResult[]
  notes           Note[]
  flashcards      Flashcard[]
  masteredCards   MasteredFlashcard[] // Added for permanent knowledge bank
}

// Added: Permanent Mastery Model
model MasteredFlashcard {
  id        String   @id @default(cuid())
  question  String   @db.Text
  answer    String   @db.Text
  subject   String?  @default("General")
  
  studentId String
  student   Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}

// Persistent Notebook Model
model Note {
  id        String   @id @default(cuid())
  title     String
  content   String   @db.Text
  color     String   @default("bg-[#fffef0]")
  
  studentId String
  student   Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Neural Lab Flashcards (Session-based or Temporary)
model Flashcard {
  id        String   @id @default(cuid())
  question  String   @db.Text
  answer    String   @db.Text
  deckName  String   @default("General")
  
  mastered  Boolean  @default(false)
  
  studentId String
  student   Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}

// Activity model to store AI chats, quiz results, etc.
model Activity {
  id        String   @id @default(cuid())
  type      String   
  input     String   @db.Text
  output    String   @db.Text
  
  studentId String
  student   Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}

// Model for the "My Downloads" section
model SavedToolResult {
  id        String   @id @default(cuid())
  toolName  String
  toolId    String
  input     String   @db.Text
  output    String   @db.Text
  category  String?  @default("Uncategorized") 
  
  studentId String
  student   Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}